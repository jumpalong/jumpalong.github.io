import{g as D}from"./event.cb23c92c.js";import{p as V,g as $}from"./user.402cd3d3.js";import{l as I,P}from"./Content.444ec0ed.js";import{b as A}from"./AddButton.vue_vue_type_script_setup_true_lang.a1a0f627.js";import{f as N,bx as O,n as k,fk as H,y as s,I as f,aQ as b,H as C,A as i,D as M,F as B,C as p,G as h,aq as Q,Y as L,ax as T,z as o,J as y,L as g,S as U,Q as j,a_ as q}from"./index.77ea77b9.js";import{E as F}from"./Ellipsis.6a608e92.js";import{b as w}from"./getCacheStaff.5c77dca0.js";import{b as z,a as G}from"./nostr.21676584.js";import{_ as J,a as Y}from"./ListItem.2e5c4d9c.js";import{_ as K}from"./Space.348ee95f.js";import"./autoAddRelayurlByEventIdStaff.9992a924.js";import"./use.86d0677f.js";import"./Markdown.e3a19335.js";import"./RelayAddButton.vue_vue_type_script_setup_true_lang.cee142be.js";import"./MavonEditor.f525084c.js";import"./use-theme-vars.64fe2e7b.js";import"./Tag.01f77ee8.js";import"./Icon.5251a253.js";import"./Drawer.vue_vue_type_script_setup_true_lang.3b66130a.js";import"./DrawerContent.7b649d5f.js";import"./RelayInfoView.15227627.js";import"./createGarbageFilter.dfbe1d02.js";import"./profile-2-400x400.6ed2b486.js";import"./ContentBlacklistView.30fccfaf.js";import"./Input.ce4c88ec.js";import"./Scrollbar.70ddaf14.js";import"./ReloadCircleSharp.b3abc11d.js";import"./Scrollbar.e8fd977e.js";import"./naiveUi.5d26e71c.js";import"./Popselect.90d95be6.js";import"./create.2deeaf6a.js";import"./Checkmark.0c0f82d0.js";import"./VirtualList.37ebf73a.js";import"./Empty.1be5048e.js";import"./create-ref-setter.fe4a2903.js";import"./NaddrLink.vue_vue_type_script_setup_true_lang.d30430c1.js";import"./UserLink.vue_vue_type_script_setup_true_lang.fb95473e.js";import"./get-slot.4ceacf82.js";const W={class:"font-bold"},X={key:0,class:"w-full"},Z=N({__name:"SearchChannelItem",props:{event:null},setup(S){const x=S,{event:e}=O(x),m=k(()=>e.value&&V(e.value)),u=k(()=>{if(e.value.kind===40)return e.value.id;if(e.value.kind===41){const t=H(e.value.tags);return t?t[1]:void 0}});return(t,c)=>(s(),f("div",{class:"flex flex-col",onClick:c[0]||(c[0]=()=>p(u)&&t.$router.push({name:"channel-message",params:{value:p(u)}}))},[b("div",W,[C(F,null,{default:i(()=>{var v;return[M(B((v=p(m).name)!=null?v:p(u)&&p(u).slice(0,10)),1)]}),_:1})]),p(m).about?(s(),f("div",X,[C(F,{class:"w-full"},{default:i(()=>[b("small",null,B(p(m).about),1)]),_:1})])):h("",!0)]))}}),ee=b("div",{class:"flex items-center justify-center"},[b("div",{id:"search-input"})],-1),He=N({__name:"SearchView",setup(S){U();const x=j(),e=k(()=>x.params.value),m=k(()=>e.value&&z(e.value)),u=k(()=>e.value&&G(e.value)),t=Q({}),c=L.createChild().addStaff(w());function v(){return c.createChild().addStaff(w())}T(e,()=>{if(t.value={},!(!e.value||e.value.length===0))if(m.value){const a=m.value.relays,l=$(m.value.pubkey,{urls:a&&new Set(a)});c.addChild(l),t.value[0]=l}else if(u.value){const a=u.value,l=u.value.relays,n=D(a.id,l&&{urls:new Set(l)});c.addChild(n),n.feat.onHasEventOnce(d=>{E(d,t.value)})}else{const a=L.createChild().addStaff(w()).addStaff({push(_){E(_,t.value)}});c.addChild(a);const l=[{search:e.value},{["#r"]:[e.value]}],n=a.createChild().addFilters(l).addExtends(L);a.addExtends(n);const d=a.createChild().addFilter({search:e.value,limit:50}).addReadUrl();a.addExtends(d)}},{immediate:!0});function E(a,l){var n,d;switch(a.kind){case 0:case 1:case 2:case 3:((n=l[a.kind])!=null?n:l[a.kind]=v()).pushEvent(a);break;case 40:case 41:((d=l.channel)!=null?d:l.channel=v()).pushEvent(a);break}}return(a,l)=>{const n=Y,d=J,_=q,R=K;return s(),o(R,{vertical:""},{default:i(()=>[ee,t.value.channel?(s(),o(_,{key:0,class:"w-full",title:"\u7FA4\u804A"},{default:i(()=>[C(d,{class:"w-full",hoverable:"",clickable:""},{default:i(()=>[(s(!0),f(g,null,y(t.value.channel.getList(),r=>(s(),o(n,{key:r.id},{default:i(()=>[C(Z,{event:r},null,8,["event"])]),_:2},1024))),128))]),_:1})]),_:1})):h("",!0),t.value[0]?(s(),o(_,{key:1,title:"\u7528\u6237"},{default:i(()=>[(s(!0),f(g,null,y(t.value[0].getList(),r=>(s(),o(I,{key:r.id,pubkey:r.pubkey,created_at:r.created_at},null,8,["pubkey","created_at"]))),128))]),_:1})):h("",!0),t.value[2]?(s(),o(_,{key:2,title:"relay"},{default:i(()=>[(s(!0),f(g,null,y(t.value[2].getList(),r=>(s(),o(A,{key:r.id,url:r.content},null,8,["url"]))),128))]),_:1})):h("",!0),t.value[1]?(s(),o(_,{key:3,title:"\u6D88\u606F"},{default:i(()=>[(s(!0),f(g,null,y(t.value[1].getList(),r=>(s(),o(P,{key:r.id,event:r},null,8,["event"]))),128))]),_:1})):h("",!0)]),_:1})}}});export{He as default};
