import{bt as S,y as m,I as B,aQ as _,aq as U,br as q,ax as G,bs as A,f as M,bw as W,z as v,C as a,n as r,aH as K,bv as X,da as Y,A as c,H as i,G as d,D as Z,F as ee,Q as te,O as h,d4 as ne,_ as oe,ao as ae}from"./index.ad5a3ab6.js";import{g as k,b as se,a as re}from"./FollowChannel.d3c824d3.js";import{_ as le}from"./PapawList.vue_vue_type_script_setup_true_lang.cfb437e4.js";import{b as ue,i as ie}from"./use.155929f4.js";import{u as ce}from"./Content.6c3a480a.js";import{_ as me}from"./RichTextEditBox.vue_vue_type_script_setup_true_lang.00f4f8c8.js";import{S as pe}from"./Scrollbar.d69db926.js";import{u as fe}from"./naiveUi.3458fb2f.js";import{a as _e}from"./nostr.e909604e.js";import{_ as de}from"./PageHeader.a78c02d2.js";import{N as he}from"./Icon.32da1a7c.js";import"./getCacheStaff.6b7a4ad5.js";import"./createGarbageFilter.4351256a.js";import"./autoAddRelayurlByEventIdStaff.5eab6df5.js";import"./user.553ed000.js";import"./ContentBlacklistView.de471595.js";import"./Input.41d0bc3a.js";import"./event.4ebd61ae.js";import"./Markdown.332b2c76.js";import"./RelayAddButton.vue_vue_type_script_setup_true_lang.bccd7cd1.js";import"./AddButton.vue_vue_type_script_setup_true_lang.67925d2e.js";import"./RelayInfoView.05c586ef.js";import"./Ellipsis.4fc54a07.js";import"./use-theme-vars.e5566cb3.js";import"./Empty.23d9a7d4.js";import"./ListItem.f184824d.js";import"./MavonEditor.0cc50f9f.js";import"./Tag.7971d92c.js";import"./Space.e1756818.js";import"./get-slot.4ceacf82.js";import"./Drawer.vue_vue_type_script_setup_true_lang.eb3fbe5c.js";import"./DrawerContent.3368dbc4.js";import"./Popselect.1828687b.js";import"./create.2deeaf6a.js";import"./Checkmark.23d68276.js";import"./VirtualList.821f5ba7.js";import"./create-ref-setter.fe4a2903.js";import"./NaddrLink.vue_vue_type_script_setup_true_lang.51b8f688.js";import"./UserLink.vue_vue_type_script_setup_true_lang.452cc1a1.js";import"./Result.66504648.js";import"./Tabs.25355f89.js";import"./Close.e32c3198.js";import"./UploadButton.vue_vue_type_script_setup_true_lang.1e92da7e.js";import"./CloudUpload.41ff2ba1.js";import"./ReloadCircleSharp.6f510cbc.js";import"./Scrollbar.3d511d24.js";const ve={},ge={version:"1.1",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",x:"0px",y:"0px",viewBox:"0 0 512 512","enable-background":"new 0 0 512 512","xml:space":"preserve"},Ce=_("g",null,[_("g",null,[_("path",{d:`M383.822,344.427c-16.045,0-31.024,5.326-41.721,15.979l-152.957-88.42c1.071-5.328,2.142-9.593,2.142-14.919\r
			c0-5.328-1.071-9.593-2.142-14.919l150.826-87.35c11.762,10.653,26.741,17.041,43.852,17.041c35.295,0,64.178-28.766,64.178-63.92\r
			C448,72.767,419.117,44,383.822,44c-35.297,0-64.179,28.767-64.179,63.92c0,5.327,1.065,9.593,2.142,14.919l-150.821,87.35\r
			c-11.767-10.654-26.741-17.041-43.856-17.041c-35.296,0-63.108,28.766-63.108,63.92c0,35.153,28.877,63.92,64.178,63.92\r
			c17.115,0,32.089-6.389,43.856-17.042l151.891,88.421c-1.076,4.255-2.141,8.521-2.141,13.847\r
			c0,34.094,27.806,61.787,62.037,61.787c34.229,0,62.036-27.693,62.036-61.787C445.858,372.12,418.052,344.427,383.822,344.427z`})])],-1),xe=[Ce];function we(s,n){return m(),B("svg",ge,xe)}const ke=S(ve,[["render",we]]),Be={},be={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 576 512"},ye=_("path",{d:"M402.6 83.2l90.2 90.2c3.8 3.8 3.8 10 0 13.8L274.4 405.6l-92.8 10.3c-12.4 1.4-22.9-9.1-21.5-21.5l10.3-92.8L388.8 83.2c3.8-3.8 10-3.8 13.8 0zm162-22.9l-48.8-48.8c-15.2-15.2-39.9-15.2-55.2 0l-35.4 35.4c-3.8 3.8-3.8 10 0 13.8l90.2 90.2c3.8 3.8 10 3.8 13.8 0l35.4-35.4c15.2-15.3 15.2-40 0-55.2zM384 346.2V448H64V128h229.8c3.2 0 6.2-1.3 8.5-3.5l40-40c7.6-7.6 2.2-20.5-8.5-20.5H48C21.5 64 0 85.5 0 112v352c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V306.2c0-10.7-12.9-16-20.5-8.5l-40 40c-2.2 2.3-3.5 5.3-3.5 8.5z",fill:"currentColor"},null,-1),Le=[ye];function $e(s,n){return m(),B("svg",be,Le)}const De=S(Be,[["render",$e]]);function Ee(s){const n=ue(),u=U(!0),t=()=>{u.value=!1};for(const o of["scroll","touchmove"])q(n==null?void 0:n.containerRef,o,t,{once:!0});const p=G(()=>{var o;return(o=s.value)==null?void 0:o.length},()=>{var o;u.value?(o=n==null?void 0:n.scrollbarInst.value)==null||o.scrollBy({top:99999,behavior:"smooth"}):p()})}function Se(s){const n=A();function u(){!s.value||(k().joinChannel(s.value),n.info("\u5DF2\u63D0\u4EA4\u52A0\u5165\u7FA4\u804A\u7684\u8BF7\u6C42"))}function t(){!s.value||(k().leaveChannel(s.value),n.info("\u5DF2\u7ECF\u63D0\u4EA4\u4E86\u79BB\u5F00\u7FA4\u804A\u7684\u8BF7\u6C42"))}return{handleJoinChannel:u,handleLeaveChannel:t}}const Ae=M({__name:"ChannelMessageList",props:{eventList:null},emits:["eventDeletion"],setup(s,{emit:n}){const u=s,{eventList:t}=W(u);return Ee(t),(p,o)=>(m(),v(le,{withPapawOptionsButtons:!1,eventList:a(t),onEventDeletion:o[0]||(o[0]=f=>n("eventDeletion",f))},null,8,["eventList"]))}}),Me={key:0,class:"flex flex-col h-full overflow-auto"},Fe={class:"felx items-center justify-center"},Lt=M({__name:"ChannelMessageView",setup(s){const n=te(),u=r(()=>_e(n.params.value)),t=r(()=>{var e;return(e=u.value)==null?void 0:e.id}),p=k();K(()=>{!t.value||ce(t.value)});const o=r(()=>t.value?p.getData().get(t.value):void 0),f=r(()=>{var e;return(e=o.value)==null?void 0:e.relayUrls}),l=r(()=>{if(!!t.value)return se(t.value,{urls:f.value})});X(l),r(()=>l.value&&l.value.getList());const b=r(()=>t.value&&re(t.value)),y=r(()=>b.value&&b.value.feat.useMetadata()),L=r(()=>{var e;if(!!t.value)return(e=o.value)==null?void 0:e.event}),$=A();function F(){var e;(e=l.value)==null||e.feat.refresh(),$.info(h("refreshing"))}function V(){var e;(e=l.value)==null||e.feat.load(),$.info(h("loading"))}setInterval(()=>{var e;(e=l.value)==null||e.feat.refresh()},15e3);const{handleJoinChannel:N,handleLeaveChannel:H}=Se(t);function J(){g.value?H():N()}const z=ie(42,l);function j(e){var C;if(!!t.value){e.tags=[...e.tags,["e",t.value,"root"]];for(const x of(C=f.value)!=null?C:[])e.tags.push(["r",x]);z(e)}}const g=r(()=>t.value?p.hasJoin(t.value):!1),O=fe();function D(){var e;if(!!t.value)return ae.neventEncode({id:t.value,relays:[...(e=f.value)!=null?e:[]]})}function R(){const e=D();!e||O(e)}function T(){const e=D();!e||ne.push({name:"edit-channel",params:{value:e}})}const P=Y();return(e,C)=>{const x=De,E=he,w=oe,I=ke,Q=de;return a(t)?(m(),B("div",Me,[a(y)?(m(),v(Q,{key:0,class:"flex-shrink-0",subtitle:a(y).name,onBack:e.$router.back},{extra:c(()=>[_("div",Fe,[a(L)&&a(L).pubkey===a(P)?(m(),v(w,{key:0,class:"mr-2",round:"",onClick:T},{default:c(()=>[i(E,null,{default:c(()=>[i(x)]),_:1})]),_:1})):d("",!0),i(w,{class:"mr-2",round:"",onClick:R},{default:c(()=>[i(E,null,{default:c(()=>[i(I)]),_:1})]),_:1}),i(w,{round:"",type:a(g)?"default":"primary",onClick:J},{default:c(()=>[Z(ee(a(g)?a(h)("leave"):a(h)("join")),1)]),_:1},8,["type"])])]),_:1},8,["subtitle","onBack"])):d("",!0),i(pe,{class:"flex-shrink flex-1",loadable:"",refreshable:"",onLoad:F,onRefresh:V},{default:c(()=>[a(l)?(m(),v(Ae,{key:0,eventList:a(l).getList()},null,8,["eventList"])):d("",!0)]),_:1}),i(me,{onSend:j})])):d("",!0)}}});export{Lt as default};
