import{_ as X,a as G}from"./Drawer.vue_vue_type_script_setup_true_lang.649137ff.js";import{c as M,f as K,u as J,aA as Y,aC as Z,ap as v,h as H,eN as ee,au as te,aB as ne,n as o,q as ae,j as R,_ as se,x as oe,bR as le,aK as ue,r as D,bt as ie,y as L,I as re,aP as U,T as de,aw as N,c0 as ce,z as me,A as B,H as p,C as j,Q as pe,S as ve,cX as fe,V as ge,an as he,ak as _e,O as E}from"./index.d72ecaa3.js";import{u as ye,M as be}from"./MavonEditor.754a851c.js";import{_ as Ce}from"./UploadInput.vue_vue_type_script_setup_true_lang.c07c5616.js";import{c as we}from"./nostr.8075d9c7.js";import{i as Te}from"./use.1968d97f.js";import{_ as ke,c as Ve}from"./Tag.3d3efa36.js";import{s as Ae}from"./prop.0533c762.js";import{_ as q}from"./Input.0c623343.js";import{_ as W}from"./Space.d36e17e7.js";import{N as Ie}from"./Icon.27b1bf3f.js";import"./DrawerContent.c9b2e0fe.js";import"./event.2b8a392f.js";import"./getCacheStaff.c38799cf.js";import"./autoAddRelayurlByEventIdStaff.81d588be.js";import"./use-theme-vars.b2281fe6.js";import"./UploadButton.vue_vue_type_script_setup_true_lang.e3a4ef10.js";import"./CloudUpload.27d8234e.js";import"./get-slot.4ceacf82.js";const Re=M("dynamic-tags",[M("input",{minWidth:"var(--n-input-width)"})]),Se=Object.assign(Object.assign(Object.assign({},H.props),Ve),{size:{type:String,default:"medium"},closable:{type:Boolean,default:!0},defaultValue:{type:Array,default:()=>[]},value:Array,inputStyle:[String,Object],inputProps:Object,max:Number,tagStyle:[String,Object],renderTag:Function,onCreate:{type:Function,default:a=>a},"onUpdate:value":[Function,Array],onUpdateValue:[Function,Array],onChange:[Function,Array]}),Fe=K({name:"DynamicTags",props:Se,setup(a){const{mergedClsPrefixRef:c,inlineThemeDisabled:f}=J(a),{localeRef:b}=Y("DynamicTags"),C=Z(a),{mergedDisabledRef:l}=C,m=v(""),g=v(!1),h=v(!0),S=v(null),r=H("DynamicTags","-dynamic-tags",Re,ee,a,c),n=v(a.defaultValue),F=te(a,"value"),_=ne(F,n),O=o(()=>b.value.add),x=o(()=>Ae(a.size)),w=o(()=>l.value||!!a.max&&_.value.length>=a.max);function T(e){const{onChange:t,"onUpdate:value":u,onUpdateValue:d}=a,{nTriggerFormInput:P,nTriggerFormChange:$}=C;t&&D(t,e),d&&D(d,e),u&&D(u,e),n.value=e,P(),$()}function k(e){const t=_.value.slice(0);t.splice(e,1),T(t)}function V(e){switch(e.key){case"Enter":y()}}function y(e){const t=e!=null?e:m.value;if(t){const u=_.value.slice(0);u.push(a.onCreate(t)),T(u)}g.value=!1,h.value=!0,m.value=""}function A(){y()}function z(){g.value=!0,ue(()=>{var e;(e=S.value)===null||e===void 0||e.focus(),h.value=!1})}const I=o(()=>{const{self:{inputWidth:e}}=r.value;return{"--n-input-width":e}}),s=f?ae("dynamic-tags",void 0,I,a):void 0;return{mergedClsPrefix:c,inputInstRef:S,localizedAdd:O,inputSize:x,inputValue:m,showInput:g,inputForceFocused:h,mergedValue:_,mergedDisabled:l,triggerDisabled:w,handleInputKeyUp:V,handleAddClick:z,handleInputBlur:A,handleCloseClick:k,handleInputConfirm:y,mergedTheme:r,cssVars:f?void 0:I,themeClass:s==null?void 0:s.themeClass,onRender:s==null?void 0:s.onRender}},render(){const{mergedTheme:a,cssVars:c,mergedClsPrefix:f,onRender:b,renderTag:C}=this;return b==null||b(),R(W,{class:[`${f}-dynamic-tags`,this.themeClass],size:"small",style:c,theme:a.peers.Space,themeOverrides:a.peerOverrides.Space,itemStyle:"display: flex;"},{default:()=>{const{mergedTheme:l,tagStyle:m,type:g,round:h,size:S,color:r,closable:n,mergedDisabled:F,showInput:_,inputValue:O,inputStyle:x,inputSize:w,inputForceFocused:T,triggerDisabled:k,handleInputKeyUp:V,handleInputBlur:y,handleAddClick:A,handleCloseClick:z,handleInputConfirm:I,$slots:s}=this;return this.mergedValue.map((e,t)=>C?C(e,t):R(ke,{key:t,theme:l.peers.Tag,themeOverrides:l.peerOverrides.Tag,style:m,type:g,round:h,size:S,color:r,closable:n,disabled:F,onClose:()=>z(t)},{default:()=>typeof e=="string"?e:e.label})).concat(_?s.input?s.input({submit:I,deactivate:y}):R(q,Object.assign({placeholder:"",size:w,style:x,autosize:!0},this.inputProps,{ref:"inputInstRef",value:O,onUpdateValue:e=>{this.inputValue=e},theme:l.peers.Input,themeOverrides:l.peerOverrides.Input,onKeyup:V,onBlur:y,internalForceFocus:T})):s.trigger?s.trigger({activate:A,disabled:k}):R(se,{dashed:!0,disabled:k,theme:l.peers.Button,themeOverrides:l.peerOverrides.Button,size:w,onClick:A},{icon:()=>R(oe,{clsPrefix:f},{default:()=>R(le,null)})}))}})}}),Oe={},xe={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 20 20"},ze=U("g",{fill:"none"},[U("path",{d:"M3 5.5A2.5 2.5 0 0 1 5.5 3h9A2.5 2.5 0 0 1 17 5.5v9a2.5 2.5 0 0 1-2.5 2.5h-9A2.5 2.5 0 0 1 3 14.5v-9zM4.5 7v7.5a1 1 0 0 0 1 1h9a1 1 0 0 0 1-1V7h-11z",fill:"currentColor"})],-1),Be=[ze];function Ue(a,c){return L(),re("svg",xe,Be)}const Pe=ie(Oe,[["render",Ue]]),$e=["id"],at=K({__name:"MarkdownEditorView",setup(a){const c=de(),f=pe(),b=ve();c.start();const C=o(()=>f.params.value),l=o(()=>f.query.new);N(l,()=>{l.value&&c.finish()});const m=v(30023),{addressPointer:g,longFormContentOptions:h,event:S}=ye(C),r=o(()=>{if(Boolean(g.value))return g.value;const e={identifier:fe(),pubkey:ge.value.publicKey,kind:m.value,relays:[]};return setTimeout(()=>{b.push({name:"markdown-editor",params:{value:he.naddrEncode(e)},query:{new:"1"}})}),e});r.value;const n=v({content:"",title:"",publishedAt:_e(),summary:"",image:"",hashtags:[]});N(h,()=>{const e=n.value,t=h.value;if(t){c.finish();for(const[u,d]of Object.entries(t))e[u]=d}},{deep:!0});const F=o(()=>["title",n.value.title]),_=o(()=>["published_at",String(n.value.publishedAt)]),O=o(()=>["summary",n.value.summary]),x=o(()=>["image",n.value.image]),w=o(()=>["a",`${r.value.kind}:${r.value.pubkey}:${r.value.identifier}`]),T=o(()=>["d",r.value.identifier]),k=o(()=>we({kind:m.value,content:n.value.content,tags:[T.value,F.value,_.value,O.value,x.value,w.value,...n.value.hashtags.map(e=>["t",e])]})),V=v(),y=ce(),A=async(e,t)=>{var d;const u=await y(t);u.url,(d=V.value)==null||d.$img2Url(e,u.url)},z=Te(m.value,void 0,void 0);function I(e){n.value.content=e,z(k.value)}const s=v(!1);return setTimeout(()=>s.value=!0),(e,t)=>{const u=Ie,d=q,P=Fe,$=W;return L(),me(G,null,{default:B(({id:Q})=>[U("div",{class:"h-full w-full",id:Q},[p(be,{ref_key:"md",ref:V,class:"h-full",onImgAdd:A,onSave:I,modelValue:n.value.content,"onUpdate:modelValue":t[1]||(t[1]=i=>n.value.content=i)},{"right-toolbar-after":B(()=>[U("button",{type:"button",onClick:t[0]||(t[0]=()=>s.value=!s.value),class:"op-icon","aria-hidden":"true",title:"\u81EA\u5B9A\u4E49"},[p(u,null,{default:B(()=>[p(Pe)]),_:1})])]),_:1},8,["modelValue"]),p(X,{show:s.value,"onUpdate:show":t[6]||(t[6]=i=>s.value=i),closable:"",height:"100%"},{default:B(()=>[p($,{vertical:""},{default:B(()=>[p(Ce,{class:"w-full",placeholder:j(E)("banner"),value:n.value.image,"onUpdate:value":t[2]||(t[2]=i=>n.value.image=i)},null,8,["placeholder","value"]),p(d,{placeholder:j(E)("title"),value:n.value.title,"onUpdate:value":t[3]||(t[3]=i=>n.value.title=i),class:"w-full"},null,8,["placeholder","value"]),p(d,{placeholder:j(E)("summary"),value:n.value.summary,"onUpdate:value":t[4]||(t[4]=i=>n.value.summary=i)},null,8,["placeholder","value"]),p(P,{value:n.value.hashtags,"onUpdate:value":t[5]||(t[5]=i=>n.value.hashtags=i)},null,8,["value"])]),_:1})]),_:1},8,["show"])],8,$e)]),_:1})}}});export{at as default};
