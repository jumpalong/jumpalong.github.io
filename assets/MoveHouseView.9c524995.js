import{f as I,n as B,aq as _,y as v,z as E,A as e,H as t,C as l,aa as q,O as u,V as ue,bs as re,aQ as C,D as c,F as r,bG as ie,I as z,J as D,L as K,G as de,Y as A,U as ce,a_ as _e,_ as pe,aZ as Q,dJ as me}from"./index.c1800e2b.js";import{_ as O,a as fe}from"./AddButton.vue_vue_type_script_setup_true_lang.6d5118af.js";import{_ as ve,a as he,b as ye}from"./UserLink.vue_vue_type_script_setup_true_lang.f5887d66.js";import{S as W}from"./Scrollbar.bfc06a16.js";import{_ as ge}from"./Input.67ce3011.js";import{_ as Y}from"./Thing.895493bd.js";import{_ as j}from"./RelayConnectListCard.vue_vue_type_script_setup_true_lang.9ebf2aaa.js";import{b as be,e as ke,j as we}from"./getCacheStaff.04455eaa.js";import{q as Ce}from"./use.42516be4.js";import{a as xe,_ as Se}from"./Checkbox.4e768866.js";import{u as Le}from"./use-theme-vars.bc2ec469.js";import{_ as Ue}from"./Space.71e20140.js";import{_ as Re}from"./Empty.6cdd22d7.js";import"./RelayInfoView.a288b455.js";import"./Ellipsis.9cb636a6.js";import"./Icon.c18adbc2.js";import"./ListItem.7fc45615.js";import"./DrawerContent.6dbdfd12.js";import"./user.a4321bbd.js";import"./nostr.8d7c0b4a.js";import"./ReloadCircleSharp.f8dea346.js";import"./Scrollbar.1fcc2d31.js";import"./autoAddRelayurlByEventIdStaff.dbe693d3.js";import"./get-slot.4ceacf82.js";const $e=I({__name:"AddRelay",props:{show:{type:Boolean},disabledList:null},emits:["add-relay","update:show"],setup(h,{emit:f}){const k=B(()=>q.getOtherList()),m=_("");return(x,p)=>{const y=ge,S=Y;return v(),E(ve,{show:h.show,"onUpdate:show":p[2]||(p[2]=d=>f("update:show",d)),closable:"",height:"100%",title:l(u)("add_relay")},{default:e(()=>[t(W,null,{default:e(()=>[t(S,{class:"my-2"},{header:e(()=>[t(y,{value:m.value,"onUpdate:value":p[0]||(p[0]=d=>m.value=d),placeholder:"eg: wss://relay.com",size:"small"},null,8,["value"])]),"header-extra":e(()=>[t(O,{onClick:p[1]||(p[1]=()=>f("add-relay",m.value)),disabled:h.disabledList&&h.disabledList.has(m.value)},null,8,["disabled"])]),_:1}),t(fe,{urls:l(k),loadable:""},{right:e(({url:d})=>[t(O,{onClick:()=>f("add-relay",d),disabled:h.disabledList&&h.disabledList.has(d)},null,8,["onClick","disabled"])]),_:1},8,["urls"])]),_:1})]),_:1},8,["show","title"])}}}),Pe=["id"],Ve=C("div",{class:"grid grid-cols-2"},null,-1),at=I({__name:"MoveHouseView",setup(h){const f=_(q.getReadList()),k=_(q.getWriteList()),m=_(!1),x=_(!1),p=[0,1,2,3,4,5,6,7,8,40,41,42,43,44,1984,9734,9735,1e4,10001,10002,3e4,30001,30008,30009,30023,30078],y=Ce("checkedKinds",p),S=[ue.value.publicKey],d=_([...S]),w=_(new Map),M=B(()=>[{kinds:y.value,authors:d.value}]),L=B(()=>(w.value.clear(),A.createChild().addStaff(be()).addFilters(M.value).addStaff({push(s){var o;const a=s.kind;w.value.set(a,((o=w.value.get(a))!=null?o:0)+1)}}).addExtends(A)));function Z(){m.value=!0,L.value.addExtends(A.createChild().addStaff(ke()).addFilters(M.value).addRelayUrls(f.value))}const G=me(10),U=B(()=>{let s=0;for(const[a,o]of w.value)s+=o;return s}),R=_(new Map);function X(){return{ok:0,error:0,ignore:0}}function H(s,a){const o=a.get(s);if(!o){const i=X();return R.value.set(s,i),i}return o}function ee(){const s=ce(new Map);R.value=s,x.value=!0,A.createChild().addFilters(M.value).addStaff({push(a){G.unShift(()=>{var o;L.value.getRelayEmiter().on("ok",a.id,({ok:i,url:V})=>{const g=H(V,s);i?g.ok++:g.error++},{overtime:6e4});for(const i of k.value){if((o=we(a.id))!=null&&o.has(i)){H(i,s).ignore++;continue}G.unShift(()=>{L.value.publish(a,new Set().add(i),{autoPublishToTagR:!1})})}})}}).addExtends(L.value)}const F=Le(),te=re(),$=_(null);function ae(s){var a;(a=$.value)==null||a.add(s),te.success(u("successfully_added"))}const P=_(!1);function le(){$.value=f.value,P.value=!0}function se(){$.value=k.value,P.value=!0}return(s,a)=>{const o=Se,i=Y,V=xe,g=_e,T=pe,N=Ue,ne=Re;return v(),E(he,null,{default:e(({id:oe})=>{var J;return[t($e,{show:P.value,"onUpdate:show":a[0]||(a[0]=n=>P.value=n),onAddRelay:ae,disabledList:(J=$.value)!=null?J:void 0},null,8,["show","disabledList"]),C("div",{id:oe},[t(W,null,{default:e(()=>[t(N,{vertical:""},{default:e(()=>[t(g,{title:l(u)("kind")},{"header-extra":e(()=>[c(r(l(U)),1)]),default:e(()=>[t(V,{value:l(y),"onUpdate:value":[a[1]||(a[1]=n=>ie(y)?y.value=n:null),a[2]||(a[2]=()=>{m.value=!1,x.value=!1})]},{default:e(()=>[(v(),z(K,null,D(p,n=>t(i,null,{header:e(()=>[t(o,{value:n,label:l(u)(`kind${n}`)},null,8,["value","label"])]),"header-extra":e(()=>{var b;return[c(r((b=w.value.get(n))!=null?b:0),1)]}),_:2},1024)),64))]),_:1},8,["value"])]),_:1},8,["title"]),t(g,{title:l(u)("include_user")},{default:e(()=>[t(V,{value:d.value,"onUpdate:value":a[3]||(a[3]=n=>d.value=n)},{default:e(()=>[Ve,(v(),z(K,null,D(S,n=>t(o,{value:n},{default:e(()=>[t(ye,{withPrefix:!1,value:n},null,8,["value"])]),_:2},1032,["value"])),64))]),_:1},8,["value"])]),_:1},8,["title"]),t(j,{urls:f.value,title:l(u)("pull")},{action:e(()=>[t(N,null,{default:e(()=>[t(T,{disabled:m.value,type:"primary",onClick:Z},{default:e(()=>[c(r(l(u)("pull")),1)]),_:1},8,["disabled"]),t(T,{type:"primary",onClick:le},{default:e(()=>[c(r(l(u)("add_relay")),1)]),_:1})]),_:1})]),_:1},8,["urls","title"]),t(j,{urls:k.value,title:l(u)("push")},{action:e(()=>[t(N,null,{default:e(()=>[t(T,{disabled:x.value||l(U)===0,type:"primary",onClick:ee},{default:e(()=>[c(r(l(u)("push"))+"("+r(l(U))+") ",1)]),_:1},8,["disabled"]),t(T,{type:"primary",onClick:se},{default:e(()=>[c(r(l(u)("add_relay")),1)]),_:1})]),_:1})]),_:1},8,["urls","title"]),t(g,{title:l(u)("result")},{"header-extra":e(()=>[c(r(l(U)),1)]),default:e(()=>[R.value.size===0?(v(),E(ne,{key:0,description:l(u)("empty_text")},null,8,["description"])):de("",!0),(v(!0),z(K,null,D(R.value,([n,b])=>(v(),E(i,null,{header:e(()=>[c(r(n),1)]),"header-extra":e(()=>[C("span",{style:Q({color:l(F).successColor})},r(b.ok),5),c(" / "),C("span",{style:Q({color:l(F).primaryColor})},r(b.ignore),5),c(" / "),C("span",{style:Q({color:l(F).errorColor})},r(b.error),5)]),_:2},1024))),256))]),_:1},8,["title"])]),_:1})]),_:1})],8,Pe)]}),_:1})}}});export{at as default};
