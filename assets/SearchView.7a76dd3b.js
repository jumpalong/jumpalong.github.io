import{g as D}from"./event.88b937ee.js";import{p as V,g as $}from"./user.62e1a4e0.js";import{l as P,P as I}from"./Content.0874daab.js";import{b as A}from"./AddButton.vue_vue_type_script_setup_true_lang.c561e4d7.js";import{f as F,bv as H,n as h,dH as O,y as l,I as _,aP as C,H as b,A as u,D as M,F as B,C as m,G as v,ap as T,X as L,aw as U,z as o,J as y,L as g,R as j,Q as z,aZ as G}from"./index.aaa5d7fe.js";import{E as R}from"./Ellipsis.386f28c1.js";import{b as x}from"./getCacheStaff.aea9394f.js";import{a as J,t as Q}from"./nostr.1df1ad91.js";import{_ as X,a as Z}from"./ListItem.6718171f.js";import{_ as q}from"./Space.d2497847.js";import"./autoAddRelayurlByEventIdStaff.4e0e9c5d.js";import"./use.90f66007.js";import"./Tag.4e188171.js";import"./Icon.832be03e.js";import"./RelayAddButton.vue_vue_type_script_setup_true_lang.b096e064.js";import"./UserLink.vue_vue_type_script_setup_true_lang.32328548.js";import"./DrawerContent.2f2df2c9.js";import"./RelayInfoView.8f13f635.js";import"./ContentBlacklistView.5d51d854.js";import"./Input.43216aad.js";import"./use-theme-vars.64abbe98.js";import"./Scrollbar.792ee0bc.js";import"./Scrollbar.7afba626.js";import"./naiveUi.026db9a7.js";import"./composables.4d653550.js";import"./Popselect.c21f6174.js";import"./create.2deeaf6a.js";import"./Checkmark.3abd8c4a.js";import"./Empty.c707a805.js";import"./create-ref-setter.fe4a2903.js";import"./get-slot.4ceacf82.js";const K={class:"font-bold"},W={key:0,class:"w-full"},Y=F({__name:"SearchChannelItem",props:{event:null},setup(E){const w=E,{event:a}=H(w),p=h(()=>a.value&&V(a.value)),i=h(()=>{if(a.value.kind===40)return a.value.id;if(a.value.kind===41){const e=O(a.value.tags);return e?e[1]:void 0}});return(e,c)=>(l(),_("div",{class:"flex flex-col",onClick:c[0]||(c[0]=()=>m(i)&&e.$router.push({name:"channel-message",params:{value:m(i)}}))},[C("div",K,[b(R,null,{default:u(()=>{var f;return[M(B((f=m(p).name)!=null?f:m(i)&&m(i).slice(0,10)),1)]}),_:1})]),m(p).about?(l(),_("div",W,[b(R,{class:"w-full"},{default:u(()=>[C("small",null,B(m(p).about),1)]),_:1})])):v("",!0)]))}}),ee=C("div",{class:"flex items-center justify-center"},[C("div",{id:"search-input"})],-1),De=F({__name:"SearchView",setup(E){j();const w=z(),a=h(()=>w.params.value),p=h(()=>a.value&&J(a.value)),i=h(()=>a.value&&Q(a.value)),e=T({}),c=L.createChild().addStaff(x());function f(){return c.createChild().addStaff(x())}U(a,()=>{if(e.value={},!(!a.value||a.value.length===0))if(p.value){const t=p.value.relays,s=$(p.value.pubkey,{urls:t&&new Set(t)});c.addChild(s),e.value[0]=s}else if(i.value){const t=i.value,s=i.value.relays,r=D(t.id,s&&{urls:new Set(s)});c.addChild(r),r.feat.onHasEventOnce(d=>{S(d,e.value)})}else{const t=L.createChild().addStaff(x()).addStaff({push(d){S(d,e.value)}});c.addChild(t);const s=t.createChild().addFilter({search:a.value}).addExtends(L);t.addExtends(s);const r=t.createChild().addFilter({search:a.value,limit:50}).addReadUrl();t.addExtends(r)}},{immediate:!0});function S(t,s){var r,d;switch(t.kind){case 0:case 1:case 2:case 3:((r=s[t.kind])!=null?r:s[t.kind]=f()).pushEvent(t);break;case 40:case 41:((d=s.channel)!=null?d:s.channel=f()).pushEvent(t);break}}return(t,s)=>{const r=Z,d=X,k=G,N=q;return l(),o(N,{vertical:""},{default:u(()=>[ee,e.value.channel?(l(),o(k,{key:0,class:"w-full",title:"\u7FA4\u804A"},{default:u(()=>[b(d,{class:"w-full",hoverable:"",clickable:""},{default:u(()=>[(l(!0),_(g,null,y(e.value.channel.getList(),n=>(l(),o(r,{key:n.id},{default:u(()=>[b(Y,{event:n},null,8,["event"])]),_:2},1024))),128))]),_:1})]),_:1})):v("",!0),e.value[0]?(l(),o(k,{key:1,title:"\u7528\u6237"},{default:u(()=>[(l(!0),_(g,null,y(e.value[0].getList(),n=>(l(),o(P,{key:n.id,pubkey:n.pubkey,created_at:n.created_at},null,8,["pubkey","created_at"]))),128))]),_:1})):v("",!0),e.value[2]?(l(),o(k,{key:2,title:"relay"},{default:u(()=>[(l(!0),_(g,null,y(e.value[2].getList(),n=>(l(),o(A,{key:n.id,url:n.content},null,8,["url"]))),128))]),_:1})):v("",!0),e.value[1]?(l(),o(k,{key:3,title:"\u6D88\u606F"},{default:u(()=>[(l(!0),_(g,null,y(e.value[1].getList(),n=>(l(),o(I,{key:n.id,event:n},null,8,["event"]))),128))]),_:1})):v("",!0)]),_:1})}}});export{De as default};
