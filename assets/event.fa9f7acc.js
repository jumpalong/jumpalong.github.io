import{a5 as b,a1 as u,a2 as s,an as c,a3 as d,a4 as l,Y as v,aj as E,ao as h,V as o,ap as m,ab as g}from"./index.5bd2a348.js";import{R as r,a as S,h as k,c as w,d as y}from"./getCacheStaff.f63839b3.js";import{c as B}from"./autoAddRelayurlByEventIdStaff.1b7cfbea.js";const L=b()(a=>{function e(){return`${a.kind}:${a.pubkey}:${a.identifier}`}return{initialization(){try{const t=r.replaceable.get(e());t&&this.beltline.pushEvent(t)}catch{}this.beltline.feat.onHasLatestEvent(t=>{r.replaceable.set(e(),t)})}}});async function R(a,e,t){return new Promise(async(n,f)=>{v.createChild().publish({kind:5,pubkey:await o.getPublicKey(),tags:a.map(i=>["e",i])},m(g.getWriteList(),e!=null?e:new Set),t)})}function C(a,e){R([a],e==null?void 0:e.urls,e)}function F(a,e){return u("getEventLineById"+a,()=>{const t=s({describe:"\u83B7\u53D6Event\u901A\u8FC7id"}).addFilter({ids:[a],limit:1}).addStaff(B()).addStaff(S()).addStaff(c()).addStaff(d()).addStaff(l());if(t.addStaff(k(a)),t.feat.withEvent()||(t.addExtends(v),t.feat.withEvent()))return t;const n=async()=>{(e==null?void 0:e.urls)&&e.urls.size>0&&(t.addRelayUrls(e.urls),await t.feat.timeoutWithEvent())||e!=null&&e.pubkey&&(t.addStaff(y(e.pubkey)),await t.feat.timeoutWithEvent())||(t.addReadUrl(),await t.feat.timeoutWithEvent())};return E(`getEventLineById:${a}`,()=>{n()},20*1e3),t},{useLocalStorage:!1})}function D(a,e){return u(`createGetEventLineByAddressPointer:${h.naddrEncode(a)}`,()=>{const t={["#d"]:[a.identifier],authors:[a.pubkey],kinds:[a.kind]},n=s({describe:"\u83B7\u53D6Event\u901A\u8FC7id"}).addFilter(t).addStaff(S()).addStaff(w()).addStaff(L(a)).addStaff(c()).addStaff(d()).addStaff(l());let f=!1;const i=async()=>{f||(f=!0,n.addStaff(y(a.pubkey)),!await n.feat.timeoutWithEvent()&&((e==null?void 0:e.urls)&&e.urls.size>0&&(n.addRelayUrls(e.urls),await n.feat.timeoutWithEvent())||(n.addReadUrl(),await n.feat.timeoutWithEvent())))};return E(`createGetEventLineByAddressPointer:${a.kind}:${a.pubkey}:${a.identifier}`,()=>{i()},20*1e3),n.feat.withEvent()||i(),n},{useLocalStorage:!1})}export{D as c,C as e,F as g};
