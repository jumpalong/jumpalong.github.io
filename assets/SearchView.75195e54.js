import{g as D}from"./event.9919dd94.js";import{p as V,g as $}from"./user.4175c514.js";import{l as I,P as O}from"./Content.9f78ea1f.js";import{b as P}from"./AddButton.vue_vue_type_script_setup_true_lang.2b858784.js";import{f as N,bv as A,n as h,dI as H,y as l,I as _,aO as C,H as b,A as u,D as M,F as B,C as p,G as v,ao as T,Y as w,av as U,z as o,J as y,L as g,S as Y,Q as j,aY as z}from"./index.7cd35645.js";import{E as F}from"./Ellipsis.becf55e6.js";import{a as S}from"./getCacheStaff.56be5503.js";import{a as G,t as J}from"./nostr.0a3fe84a.js";import{_ as Q,a as q}from"./ListItem.a0bb8d61.js";import{_ as K}from"./Space.f39af9e2.js";import"./autoAddRelayurlByEventIdStaff.abf88ad2.js";import"./use.7a309851.js";import"./Tag.e9cb6e27.js";import"./Icon.a7306fa3.js";import"./RelayAddButton.vue_vue_type_script_setup_true_lang.e7c9335a.js";import"./UserLink.vue_vue_type_script_setup_true_lang.c2e785ef.js";import"./DrawerContent.d047e7e8.js";import"./RelayInfoView.a899050e.js";import"./ContentBlacklistView.d00ce85c.js";import"./Input.37ed4e7f.js";import"./use-theme-vars.1621a02a.js";import"./Scrollbar.2351c9b1.js";import"./ReloadCircleSharp.2318b47d.js";import"./Scrollbar.bd293609.js";import"./naiveUi.d4181b18.js";import"./composables.7e69fec0.js";import"./Popselect.1480f0ab.js";import"./create.2deeaf6a.js";import"./Checkmark.8206c9e3.js";import"./Empty.5b6f38e9.js";import"./create-ref-setter.fe4a2903.js";import"./get-slot.4ceacf82.js";const W={class:"font-bold"},X={key:0,class:"w-full"},Z=N({__name:"SearchChannelItem",props:{event:null},setup(x){const L=x,{event:a}=A(L),m=h(()=>a.value&&V(a.value)),i=h(()=>{if(a.value.kind===40)return a.value.id;if(a.value.kind===41){const e=H(a.value.tags);return e?e[1]:void 0}});return(e,c)=>(l(),_("div",{class:"flex flex-col",onClick:c[0]||(c[0]=()=>p(i)&&e.$router.push({name:"channel-message",params:{value:p(i)}}))},[C("div",W,[b(F,null,{default:u(()=>{var f;return[M(B((f=p(m).name)!=null?f:p(i)&&p(i).slice(0,10)),1)]}),_:1})]),p(m).about?(l(),_("div",X,[b(F,{class:"w-full"},{default:u(()=>[C("small",null,B(p(m).about),1)]),_:1})])):v("",!0)]))}}),ee=C("div",{class:"flex items-center justify-center"},[C("div",{id:"search-input"})],-1),Ve=N({__name:"SearchView",setup(x){Y();const L=j(),a=h(()=>L.params.value),m=h(()=>a.value&&G(a.value)),i=h(()=>a.value&&J(a.value)),e=T({}),c=w.createChild().addStaff(S());function f(){return c.createChild().addStaff(S())}U(a,()=>{if(e.value={},!(!a.value||a.value.length===0))if(m.value){const t=m.value.relays,s=$(m.value.pubkey,{urls:t&&new Set(t)});c.addChild(s),e.value[0]=s}else if(i.value){const t=i.value,s=i.value.relays,r=D(t.id,s&&{urls:new Set(s)});c.addChild(r),r.feat.onHasEventOnce(d=>{E(d,e.value)})}else{const t=w.createChild().addStaff(S()).addStaff({push(d){E(d,e.value)}});c.addChild(t);const s=t.createChild().addFilter({search:a.value}).addExtends(w);t.addExtends(s);const r=t.createChild().addFilter({search:a.value,limit:50}).addReadUrl();t.addExtends(r)}},{immediate:!0});function E(t,s){var r,d;switch(t.kind){case 0:case 1:case 2:case 3:((r=s[t.kind])!=null?r:s[t.kind]=f()).pushEvent(t);break;case 40:case 41:((d=s.channel)!=null?d:s.channel=f()).pushEvent(t);break}}return(t,s)=>{const r=q,d=Q,k=z,R=K;return l(),o(R,{vertical:""},{default:u(()=>[ee,e.value.channel?(l(),o(k,{key:0,class:"w-full",title:"\u7FA4\u804A"},{default:u(()=>[b(d,{class:"w-full",hoverable:"",clickable:""},{default:u(()=>[(l(!0),_(g,null,y(e.value.channel.getList(),n=>(l(),o(r,{key:n.id},{default:u(()=>[b(Z,{event:n},null,8,["event"])]),_:2},1024))),128))]),_:1})]),_:1})):v("",!0),e.value[0]?(l(),o(k,{key:1,title:"\u7528\u6237"},{default:u(()=>[(l(!0),_(g,null,y(e.value[0].getList(),n=>(l(),o(I,{key:n.id,pubkey:n.pubkey,created_at:n.created_at},null,8,["pubkey","created_at"]))),128))]),_:1})):v("",!0),e.value[2]?(l(),o(k,{key:2,title:"relay"},{default:u(()=>[(l(!0),_(g,null,y(e.value[2].getList(),n=>(l(),o(P,{key:n.id,url:n.content},null,8,["url"]))),128))]),_:1})):v("",!0),e.value[1]?(l(),o(k,{key:3,title:"\u6D88\u606F"},{default:u(()=>[(l(!0),_(g,null,y(e.value[1].getList(),n=>(l(),o(O,{key:n.id,event:n},null,8,["event"]))),128))]),_:1})):v("",!0)]),_:1})}}});export{Ve as default};
