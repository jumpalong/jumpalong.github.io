import{g as R}from"./event.ce5eb45a.js";import{p as V,g as $}from"./user.fc7031f0.js";import{n as I,P}from"./Content.8be18bd0.js";import{b as A}from"./AddButton.vue_vue_type_script_setup_true_lang.ef072c2b.js";import{f as F,bD as O,n as k,fs as H,y as s,I as f,aV as C,H as b,A as i,D as M,F as B,C as m,G as h,av as T,Y as w,a7 as S,aC as U,z as o,J as y,L as g,S as j,Q as z,b3 as G}from"./index.d4beb9d4.js";import{E as D}from"./Ellipsis.253ff5d9.js";import{b as J,a as Q}from"./nostr.47476c5c.js";import{_ as Y,a as q}from"./ListItem.666b7fc1.js";import{_ as K}from"./Space.efc7ad45.js";import"./autoAddRelayurlByEventIdStaff.2b1ec972.js";import"./getCacheStaff.91029245.js";import"./use.e428b080.js";import"./Markdown.57fa6aca.js";import"./RelayAddButton.vue_vue_type_script_setup_true_lang.735c4e9a.js";import"./MavonEditor.104735e2.js";import"./use-theme-vars.a322f4f7.js";import"./Tag.e49d23ad.js";import"./Icon.7dabd37c.js";import"./Drawer.vue_vue_type_script_setup_true_lang.1bab6a71.js";import"./DrawerContent.46dce308.js";import"./RelayInfoView.6d09c0b2.js";import"./createGarbageFilter.5dbcc016.js";import"./profile-2-400x400.238412c3.js";import"./ContentBlacklistView.1ecd7aa0.js";import"./Input.217a6f50.js";import"./Scrollbar.a74a5321.js";import"./ReloadCircleSharp.85fc38a8.js";import"./Scrollbar.89fcbc4c.js";import"./naiveUi.3bf7422c.js";import"./Dropdown.75f1bb37.js";import"./create.2deeaf6a.js";import"./Empty.501abe6f.js";import"./NaddrLink.vue_vue_type_script_setup_true_lang.2d9d8164.js";import"./UserLink.vue_vue_type_script_setup_true_lang.04cd38ad.js";import"./get-slot.4ceacf82.js";const W={class:"font-bold"},X={key:0,class:"w-full"},Z=F({__name:"SearchChannelItem",props:{event:null},setup(x){const L=x,{event:e}=O(L),p=k(()=>e.value&&V(e.value)),u=k(()=>{if(e.value.kind===40)return e.value.id;if(e.value.kind===41){const t=H(e.value.tags);return t?t[1]:void 0}});return(t,c)=>(s(),f("div",{class:"flex flex-col",onClick:c[0]||(c[0]=()=>m(u)&&t.$router.push({name:"channel-message",params:{value:m(u)}}))},[C("div",W,[b(D,null,{default:i(()=>{var v;return[M(B((v=m(p).name)!=null?v:m(u)&&m(u).slice(0,10)),1)]}),_:1})]),m(p).about?(s(),f("div",X,[b(D,{class:"w-full"},{default:i(()=>[C("small",null,B(m(p).about),1)]),_:1})])):h("",!0)]))}}),ee=C("div",{class:"flex items-center justify-center"},[C("div",{id:"search-input"})],-1),Pe=F({__name:"SearchView",setup(x){j();const L=z(),e=k(()=>L.params.value),p=k(()=>e.value&&J(e.value)),u=k(()=>e.value&&Q(e.value)),t=T({}),c=w.createChild().addStaff(S());function v(){return c.createChild().addStaff(S())}U(e,()=>{if(t.value={},!(!e.value||e.value.length===0))if(p.value){const a=p.value.relays,l=$(p.value.pubkey,{urls:a&&new Set(a)});c.addChild(l),t.value[0]=l}else if(u.value){const a=u.value,l=u.value.relays,r=R(a.id,l&&{urls:new Set(l)});c.addChild(r),r.feat.onHasEventOnce(d=>{E(d,t.value)})}else{const a=w.createChild().addStaff(S()).addStaff({push(_){E(_,t.value)}});c.addChild(a);const l=[{search:e.value},{["#r"]:[e.value]}],r=a.createChild().addFilters(l).addExtends(w);a.addExtends(r);const d=a.createChild().addFilter({search:e.value,limit:50}).addReadUrl();a.addExtends(d)}},{immediate:!0});function E(a,l){var r,d;switch(a.kind){case 0:case 1:case 2:case 3:((r=l[a.kind])!=null?r:l[a.kind]=v()).pushEvent(a);break;case 40:case 41:((d=l.channel)!=null?d:l.channel=v()).pushEvent(a);break}}return(a,l)=>{const r=q,d=Y,_=G,N=K;return s(),o(N,{vertical:""},{default:i(()=>[ee,t.value.channel?(s(),o(_,{key:0,class:"w-full",title:"\u7FA4\u804A"},{default:i(()=>[b(d,{class:"w-full",hoverable:"",clickable:""},{default:i(()=>[(s(!0),f(g,null,y(t.value.channel.getList(),n=>(s(),o(r,{key:n.id},{default:i(()=>[b(Z,{event:n},null,8,["event"])]),_:2},1024))),128))]),_:1})]),_:1})):h("",!0),t.value[0]?(s(),o(_,{key:1,title:"\u7528\u6237"},{default:i(()=>[(s(!0),f(g,null,y(t.value[0].getList(),n=>(s(),o(I,{key:n.id,pubkey:n.pubkey,created_at:n.created_at},null,8,["pubkey","created_at"]))),128))]),_:1})):h("",!0),t.value[2]?(s(),o(_,{key:2,title:"relay"},{default:i(()=>[(s(!0),f(g,null,y(t.value[2].getList(),n=>(s(),o(A,{key:n.id,url:n.content},null,8,["url"]))),128))]),_:1})):h("",!0),t.value[1]?(s(),o(_,{key:3,title:"\u6D88\u606F"},{default:i(()=>[(s(!0),f(g,null,y(t.value[1].getList(),n=>(s(),o(P,{key:n.id,event:n},null,8,["event"]))),128))]),_:1})):h("",!0)]),_:1})}}});export{Pe as default};
