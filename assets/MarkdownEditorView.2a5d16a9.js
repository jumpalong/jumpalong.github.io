import{_ as Z,a as ee}from"./Drawer.vue_vue_type_script_setup_true_lang.2d79a054.js";import{C as te}from"./Copy16Filled.f39e4697.js";import{c as N,f as q,u as ne,aB as ae,aD as oe,aq as g,h as W,eX as se,av as le,aC as ue,n as l,q as ie,j as O,_ as re,x as de,bW as ce,aL as me,r as E,bu as pe,y as K,I as ve,aQ as M,T as fe,ax as L,db as ge,cg as he,z as _e,A as x,H as c,C as P,Q as ye,S as be,d3 as Ce,ao as H,a7 as we,O as j}from"./index.263e31e4.js";import{u as Te}from"./Markdown.15565884.js";import{M as ke}from"./MavonEditor.0f6e692f.js";import{_ as Ve}from"./UploadInput.vue_vue_type_script_setup_true_lang.d2cc71bb.js";import{u as Fe}from"./naiveUi.25b0ce2c.js";import{c as Ie}from"./nostr.edffcf4c.js";import{i as Se}from"./use.005c1652.js";import{_ as Re,c as Ae}from"./Tag.dd0e062b.js";import{s as Oe}from"./prop.0533c762.js";import{_ as Q}from"./Input.6e809293.js";import{_ as X}from"./Space.117fa1dd.js";import{N as xe}from"./Icon.07f0951b.js";import"./DrawerContent.2b9bd506.js";import"./event.f4defe96.js";import"./getCacheStaff.b1915842.js";import"./autoAddRelayurlByEventIdStaff.ed9d5285.js";import"./use-theme-vars.91052754.js";import"./UploadButton.vue_vue_type_script_setup_true_lang.77c7d760.js";import"./CloudUpload.0792136c.js";import"./get-slot.4ceacf82.js";const ze=N("dynamic-tags",[N("input",{minWidth:"var(--n-input-width)"})]),Be=Object.assign(Object.assign(Object.assign({},W.props),Ae),{size:{type:String,default:"medium"},closable:{type:Boolean,default:!0},defaultValue:{type:Array,default:()=>[]},value:Array,inputStyle:[String,Object],inputProps:Object,max:Number,tagStyle:[String,Object],renderTag:Function,onCreate:{type:Function,default:a=>a},"onUpdate:value":[Function,Array],onUpdateValue:[Function,Array],onChange:[Function,Array]}),Ue=q({name:"DynamicTags",props:Be,setup(a){const{mergedClsPrefixRef:m,inlineThemeDisabled:h}=ne(a),{localeRef:C}=ae("DynamicTags"),w=oe(a),{mergedDisabledRef:i}=w,p=g(""),_=g(!1),y=g(!0),z=g(null),V=W("DynamicTags","-dynamic-tags",ze,se,a,m),r=g(a.defaultValue),n=le(a,"value"),b=ue(n,r),B=l(()=>C.value.add),U=l(()=>Oe(a.size)),F=l(()=>i.value||!!a.max&&b.value.length>=a.max);function I(e){const{onChange:s,"onUpdate:value":T,onUpdateValue:o}=a,{nTriggerFormInput:t,nTriggerFormChange:f}=w;s&&E(s,e),o&&E(o,e),T&&E(T,e),r.value=e,t(),f()}function S(e){const s=b.value.slice(0);s.splice(e,1),I(s)}function $(e){switch(e.key){case"Enter":v()}}function v(e){const s=e!=null?e:p.value;if(s){const T=b.value.slice(0);T.push(a.onCreate(s)),I(T)}_.value=!1,y.value=!0,p.value=""}function R(){v()}function D(){_.value=!0,me(()=>{var e;(e=z.value)===null||e===void 0||e.focus(),y.value=!1})}const A=l(()=>{const{self:{inputWidth:e}}=V.value;return{"--n-input-width":e}}),u=h?ie("dynamic-tags",void 0,A,a):void 0;return{mergedClsPrefix:m,inputInstRef:z,localizedAdd:B,inputSize:U,inputValue:p,showInput:_,inputForceFocused:y,mergedValue:b,mergedDisabled:i,triggerDisabled:F,handleInputKeyUp:$,handleAddClick:D,handleInputBlur:R,handleCloseClick:S,handleInputConfirm:v,mergedTheme:V,cssVars:h?void 0:A,themeClass:u==null?void 0:u.themeClass,onRender:u==null?void 0:u.onRender}},render(){const{mergedTheme:a,cssVars:m,mergedClsPrefix:h,onRender:C,renderTag:w}=this;return C==null||C(),O(X,{class:[`${h}-dynamic-tags`,this.themeClass],size:"small",style:m,theme:a.peers.Space,themeOverrides:a.peerOverrides.Space,itemStyle:"display: flex;"},{default:()=>{const{mergedTheme:i,tagStyle:p,type:_,round:y,size:z,color:V,closable:r,mergedDisabled:n,showInput:b,inputValue:B,inputStyle:U,inputSize:F,inputForceFocused:I,triggerDisabled:S,handleInputKeyUp:$,handleInputBlur:v,handleAddClick:R,handleCloseClick:D,handleInputConfirm:A,$slots:u}=this;return this.mergedValue.map((e,s)=>w?w(e,s):O(Re,{key:s,theme:i.peers.Tag,themeOverrides:i.peerOverrides.Tag,style:p,type:_,round:y,size:z,color:V,closable:r,disabled:n,onClose:()=>D(s)},{default:()=>typeof e=="string"?e:e.label})).concat(b?u.input?u.input({submit:A,deactivate:v}):O(Q,Object.assign({placeholder:"",size:F,style:U,autosize:!0},this.inputProps,{ref:"inputInstRef",value:B,onUpdateValue:e=>{this.inputValue=e},theme:i.peers.Input,themeOverrides:i.peerOverrides.Input,onKeyup:$,onBlur:v,internalForceFocus:I})):u.trigger?u.trigger({activate:R,disabled:S}):O(re,{dashed:!0,disabled:S,theme:i.peers.Button,themeOverrides:i.peerOverrides.Button,size:F,onClick:R},{icon:()=>O(de,{clsPrefix:h},{default:()=>O(ce,null)})}))}})}}),$e={},De={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 20 20"},Pe=M("g",{fill:"none"},[M("path",{d:"M3 5.5A2.5 2.5 0 0 1 5.5 3h9A2.5 2.5 0 0 1 17 5.5v9a2.5 2.5 0 0 1-2.5 2.5h-9A2.5 2.5 0 0 1 3 14.5v-9zM4.5 7v7.5a1 1 0 0 0 1 1h9a1 1 0 0 0 1-1V7h-11z",fill:"currentColor"})],-1),je=[Pe];function Me(a,m){return K(),ve("svg",De,je)}const Ee=pe($e,[["render",Me]]),Ne=["id"],Le=["title"],He=["title"],pt=q({__name:"MarkdownEditorView",setup(a){const m=fe(),h=ye(),C=be();m.start();const w=l(()=>h.params.value),i=l(()=>h.query.new);L(i,()=>{i.value&&m.finish()});const p=g(30023),{addressPointer:_,longFormContentOptions:y,event:z}=Te(w),V=ge(),r=l(()=>{var t;if(Boolean(_.value))return _.value;const o={identifier:Ce(),pubkey:(t=V.value)!=null?t:"",kind:p.value,relays:[]};return setTimeout(()=>{C.push({name:"markdown-editor",params:{value:H.naddrEncode(o)},query:{new:"1"}})}),o});r.value;const n=g({content:"",title:"",publishedAt:we(),summary:"",image:"",hashtags:[]});L(y,()=>{const o=n.value,t=y.value;if(t){m.finish();for(const[f,k]of Object.entries(t))o[f]=k}},{deep:!0});const b=l(()=>["title",n.value.title]),B=l(()=>["published_at",String(n.value.publishedAt)]),U=l(()=>["summary",n.value.summary]),F=l(()=>["image",n.value.image]),I=l(()=>["a",`${r.value.kind}:${r.value.pubkey}:${r.value.identifier}`]),S=l(()=>["d",r.value.identifier]),$=l(()=>Ie({kind:p.value,content:n.value.content,tags:[S.value,b.value,B.value,U.value,F.value,I.value,...n.value.hashtags.map(o=>["t",o])]})),v=g(),R=he(),D=async(o,t)=>{var k;const f=await R(t);f.url,(k=v.value)==null||k.$img2Url(o,f.url)},A=Se(p.value,void 0,void 0);function u(o){n.value.content=o,A($.value)}const e=g(!1);setTimeout(()=>e.value=!0);const s=Fe();function T(){const o=H.naddrEncode(r.value);s(o)}return(o,t)=>{const f=xe,k=Q,G=Ue,J=X;return K(),_e(ee,null,{default:x(({id:Y})=>[M("div",{class:"h-full w-full",id:Y},[c(ke,{ref_key:"md",ref:v,class:"h-full",onImgAdd:D,onSave:u,modelValue:n.value.content,"onUpdate:modelValue":t[1]||(t[1]=d=>n.value.content=d)},{"right-toolbar-after":x(()=>[M("button",{type:"button",onClick:T,class:"op-icon","aria-hidden":"true",title:`${P(j)("copy")}naddr`},[c(f,null,{default:x(()=>[c(te)]),_:1})],8,Le),M("button",{type:"button",onClick:t[0]||(t[0]=()=>e.value=!e.value),class:"op-icon","aria-hidden":"true",title:P(j)("edit")},[c(f,null,{default:x(()=>[c(Ee)]),_:1})],8,He)]),_:1},8,["modelValue"]),c(Z,{show:e.value,"onUpdate:show":t[6]||(t[6]=d=>e.value=d),closable:"",height:"100%"},{default:x(()=>[c(J,{vertical:""},{default:x(()=>[c(Ve,{class:"w-full",placeholder:P(j)("banner"),value:n.value.image,"onUpdate:value":t[2]||(t[2]=d=>n.value.image=d)},null,8,["placeholder","value"]),c(k,{placeholder:P(j)("title"),value:n.value.title,"onUpdate:value":t[3]||(t[3]=d=>n.value.title=d),class:"w-full"},null,8,["placeholder","value"]),c(k,{placeholder:P(j)("summary"),value:n.value.summary,"onUpdate:value":t[4]||(t[4]=d=>n.value.summary=d)},null,8,["placeholder","value"]),c(G,{value:n.value.hashtags,"onUpdate:value":t[5]||(t[5]=d=>n.value.hashtags=d)},null,8,["value"])]),_:1})]),_:1},8,["show"])],8,Ne)]),_:1})}}});export{pt as default};
