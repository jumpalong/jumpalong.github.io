import{_ as ee,a as te}from"./Drawer.vue_vue_type_script_setup_true_lang.3b66130a.js";import{C as ne}from"./Copy16Filled.a864cc16.js";import{c as L,f as W,u as ae,aB as oe,aD as se,aq as v,h as K,eX as le,av as ue,aC as ie,n as l,q as re,j as O,_ as de,x as ce,bW as me,aL as pe,r as N,bu as ve,y as Q,I as fe,aQ as M,T as ge,ax as H,db as he,cg as _e,z as ye,A as x,H as d,C as P,Q as be,S as Ce,d3 as we,ao as q,a6 as Te,O as j}from"./index.77ea77b9.js";import{u as ke}from"./Markdown.e3a19335.js";import{M as Ve}from"./MavonEditor.f525084c.js";import{_ as Fe}from"./UploadInput.vue_vue_type_script_setup_true_lang.961c7d56.js";import{u as Ie}from"./naiveUi.5d26e71c.js";import{c as Se}from"./nostr.21676584.js";import{i as Re}from"./use.86d0677f.js";import{_ as Ae,c as Oe}from"./Tag.01f77ee8.js";import{s as xe}from"./prop.0533c762.js";import{_ as X}from"./Input.ce4c88ec.js";import{_ as G}from"./Space.348ee95f.js";import{N as ze}from"./Icon.5251a253.js";import"./DrawerContent.7b649d5f.js";import"./event.cb23c92c.js";import"./getCacheStaff.5c77dca0.js";import"./autoAddRelayurlByEventIdStaff.9992a924.js";import"./use-theme-vars.64fe2e7b.js";import"./UploadButton.vue_vue_type_script_setup_true_lang.dafcbafe.js";import"./CloudUpload.c2bcc20b.js";import"./get-slot.4ceacf82.js";const Be=L("dynamic-tags",[L("input",{minWidth:"var(--n-input-width)"})]),Ue=Object.assign(Object.assign(Object.assign({},K.props),Oe),{size:{type:String,default:"medium"},closable:{type:Boolean,default:!0},defaultValue:{type:Array,default:()=>[]},value:Array,inputStyle:[String,Object],inputProps:Object,max:Number,tagStyle:[String,Object],renderTag:Function,onCreate:{type:Function,default:a=>a},"onUpdate:value":[Function,Array],onUpdateValue:[Function,Array],onChange:[Function,Array]}),$e=W({name:"DynamicTags",props:Ue,setup(a){const{mergedClsPrefixRef:m,inlineThemeDisabled:f}=ae(a),{localeRef:_}=oe("DynamicTags"),y=se(a),{mergedDisabledRef:i}=y,p=v(""),g=v(!1),b=v(!0),C=v(null),z=K("DynamicTags","-dynamic-tags",Be,le,a,m),F=v(a.defaultValue),c=ue(a,"value"),t=ie(c,F),B=l(()=>_.value.add),U=l(()=>xe(a.size)),I=l(()=>i.value||!!a.max&&t.value.length>=a.max);function S(e){const{onChange:o,"onUpdate:value":T,onUpdateValue:E}=a,{nTriggerFormInput:s,nTriggerFormChange:n}=y;o&&N(o,e),E&&N(E,e),T&&N(T,e),F.value=e,s(),n()}function R(e){const o=t.value.slice(0);o.splice(e,1),S(o)}function $(e){switch(e.key){case"Enter":h()}}function h(e){const o=e!=null?e:p.value;if(o){const T=t.value.slice(0);T.push(a.onCreate(o)),S(T)}g.value=!1,b.value=!0,p.value=""}function w(){h()}function D(){g.value=!0,pe(()=>{var e;(e=C.value)===null||e===void 0||e.focus(),b.value=!1})}const A=l(()=>{const{self:{inputWidth:e}}=z.value;return{"--n-input-width":e}}),u=f?re("dynamic-tags",void 0,A,a):void 0;return{mergedClsPrefix:m,inputInstRef:C,localizedAdd:B,inputSize:U,inputValue:p,showInput:g,inputForceFocused:b,mergedValue:t,mergedDisabled:i,triggerDisabled:I,handleInputKeyUp:$,handleAddClick:D,handleInputBlur:w,handleCloseClick:R,handleInputConfirm:h,mergedTheme:z,cssVars:f?void 0:A,themeClass:u==null?void 0:u.themeClass,onRender:u==null?void 0:u.onRender}},render(){const{mergedTheme:a,cssVars:m,mergedClsPrefix:f,onRender:_,renderTag:y}=this;return _==null||_(),O(G,{class:[`${f}-dynamic-tags`,this.themeClass],size:"small",style:m,theme:a.peers.Space,themeOverrides:a.peerOverrides.Space,itemStyle:"display: flex;"},{default:()=>{const{mergedTheme:i,tagStyle:p,type:g,round:b,size:C,color:z,closable:F,mergedDisabled:c,showInput:t,inputValue:B,inputStyle:U,inputSize:I,inputForceFocused:S,triggerDisabled:R,handleInputKeyUp:$,handleInputBlur:h,handleAddClick:w,handleCloseClick:D,handleInputConfirm:A,$slots:u}=this;return this.mergedValue.map((e,o)=>y?y(e,o):O(Ae,{key:o,theme:i.peers.Tag,themeOverrides:i.peerOverrides.Tag,style:p,type:g,round:b,size:C,color:z,closable:F,disabled:c,onClose:()=>D(o)},{default:()=>typeof e=="string"?e:e.label})).concat(t?u.input?u.input({submit:A,deactivate:h}):O(X,Object.assign({placeholder:"",size:I,style:U,autosize:!0},this.inputProps,{ref:"inputInstRef",value:B,onUpdateValue:e=>{this.inputValue=e},theme:i.peers.Input,themeOverrides:i.peerOverrides.Input,onKeyup:$,onBlur:h,internalForceFocus:S})):u.trigger?u.trigger({activate:w,disabled:R}):O(de,{dashed:!0,disabled:R,theme:i.peers.Button,themeOverrides:i.peerOverrides.Button,size:I,onClick:w},{icon:()=>O(ce,{clsPrefix:f},{default:()=>O(me,null)})}))}})}}),De={},Pe={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 20 20"},je=M("g",{fill:"none"},[M("path",{d:"M3 5.5A2.5 2.5 0 0 1 5.5 3h9A2.5 2.5 0 0 1 17 5.5v9a2.5 2.5 0 0 1-2.5 2.5h-9A2.5 2.5 0 0 1 3 14.5v-9zM4.5 7v7.5a1 1 0 0 0 1 1h9a1 1 0 0 0 1-1V7h-11z",fill:"currentColor"})],-1),Me=[je];function Ee(a,m){return Q(),fe("svg",Pe,Me)}const Ne=ve(De,[["render",Ee]]),Le=["id"],He=["title"],qe=["title"],vt=W({__name:"MarkdownEditorView",setup(a){const m=ge(),f=be(),_=Ce();m.start();const y=l(()=>f.params.value),i=l(()=>f.query.new);H(i,()=>{i.value&&m.finish()});const p=v(30023),{addressPointer:g,line:b,longFormContentOptions:C,event:z}=ke(y),F=he(),c=l(()=>{var n;if(Boolean(g.value))return g.value;const s={identifier:we(),pubkey:(n=F.value)!=null?n:"",kind:p.value,relays:[]};return setTimeout(()=>{_.push({name:"markdown-editor",params:{value:q.naddrEncode(s)},query:{new:"1"}})}),s});c.value;const t=v({content:"",title:"",publishedAt:Te(),summary:"",image:"",hashtags:[]});H(C,()=>{const s=t.value,n=C.value;if(n){setTimeout(()=>{m.finish()});for(const[k,V]of Object.entries(n))s[k]=V}},{deep:!0,immediate:!0});const B=l(()=>["title",t.value.title]),U=l(()=>["published_at",String(t.value.publishedAt)]),I=l(()=>["summary",t.value.summary]),S=l(()=>["image",t.value.image]),R=l(()=>["a",`${c.value.kind}:${c.value.pubkey}:${c.value.identifier}`]),$=l(()=>["d",c.value.identifier]),h=l(()=>Se({kind:p.value,content:t.value.content,tags:[$.value,B.value,U.value,I.value,S.value,R.value,...t.value.hashtags.map(s=>["t",s])]})),w=v(),D=_e(),A=async(s,n)=>{var V;const k=await D(n);k.url,(V=w.value)==null||V.$img2Url(s,k.url)},u=Re(p.value,b,void 0);function e(s){t.value.content=s,u(h.value)}const o=v(!1);setTimeout(()=>o.value=!0);const T=Ie();function E(){const s=q.naddrEncode(c.value);T(s)}return(s,n)=>{const k=ze,V=X,J=$e,Y=G;return Q(),ye(te,null,{default:x(({id:Z})=>[M("div",{class:"h-full w-full",id:Z},[d(Ve,{ref_key:"md",ref:w,class:"h-full",onImgAdd:A,onSave:e,modelValue:t.value.content,"onUpdate:modelValue":n[1]||(n[1]=r=>t.value.content=r)},{"right-toolbar-after":x(()=>[M("button",{type:"button",onClick:E,class:"op-icon","aria-hidden":"true",title:`${P(j)("copy")}naddr`},[d(k,null,{default:x(()=>[d(ne)]),_:1})],8,He),M("button",{type:"button",onClick:n[0]||(n[0]=()=>o.value=!o.value),class:"op-icon","aria-hidden":"true",title:P(j)("edit")},[d(k,null,{default:x(()=>[d(Ne)]),_:1})],8,qe)]),_:1},8,["modelValue"]),d(ee,{show:o.value,"onUpdate:show":n[6]||(n[6]=r=>o.value=r),closable:"",height:"100%"},{default:x(()=>[d(Y,{vertical:""},{default:x(()=>[d(Fe,{class:"w-full",placeholder:P(j)("banner"),value:t.value.image,"onUpdate:value":n[2]||(n[2]=r=>t.value.image=r)},null,8,["placeholder","value"]),d(V,{placeholder:P(j)("title"),value:t.value.title,"onUpdate:value":n[3]||(n[3]=r=>t.value.title=r),class:"w-full"},null,8,["placeholder","value"]),d(V,{placeholder:P(j)("summary"),value:t.value.summary,"onUpdate:value":n[4]||(n[4]=r=>t.value.summary=r)},null,8,["placeholder","value"]),d(J,{value:t.value.hashtags,"onUpdate:value":n[5]||(n[5]=r=>t.value.hashtags=r)},null,8,["value"])]),_:1})]),_:1},8,["show"])],8,Le)]),_:1})}}});export{vt as default};
