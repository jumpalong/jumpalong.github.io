import{a9 as b,aa as r,a2 as u,a3 as s,a6 as c,ak as d,a4 as l,a5 as v,Y as E,am as S,Z as h,ar as o,V as m,as as g,at as k,a8 as y}from"./index.dd8c0757.js";import{c as w}from"./autoAddRelayurlByEventIdStaff.2840aa6c.js";import{g as B}from"./getCacheStaff.19f888e0.js";const L=b()(a=>{function e(){return`${a.kind}:${a.pubkey}:${a.identifier}`}return{initialization(){try{const t=r.replaceable.get(e());t&&this.beltline.pushEvent(t)}catch{}this.beltline.feat.onHasLatestEvent(t=>{r.replaceable.set(e(),t)})}}});async function R(a,e,t){return new Promise(async(n,f)=>{E.createChild().publish({kind:5,pubkey:await m.getPublicKey(),tags:a.map(i=>["e",i])},g(k.getWriteList(),e!=null?e:new Set),t)})}function C(a,e){R([a],e==null?void 0:e.urls,e)}function F(a,e){return u("getEventLineById"+a,()=>{const t=s({describe:"\u83B7\u53D6Event\u901A\u8FC7id"}).addFilter({ids:[a],limit:1}).addStaff(w()).addStaff(c()).addStaff(d()).addStaff(l()).addStaff(v());if(t.addStaff(B(a)),t.feat.withEvent()||(t.addExtends(E),t.feat.withEvent()))return t;const n=async()=>{(e==null?void 0:e.urls)&&e.urls.size>0&&(t.addRelayUrls(e.urls),await t.feat.timeoutWithEvent())||e!=null&&e.pubkey&&(t.addStaff(y(e.pubkey)),await t.feat.timeoutWithEvent())||(t.addReadUrl(),await t.feat.timeoutWithEvent())};return S(`getEventLineById:${a}`,()=>{n()},20*1e3),t},{useLocalStorage:!1})}function D(a,e){return u(`createGetEventLineByAddressPointer:${o.naddrEncode(a)}`,()=>{const t={["#d"]:[a.identifier],authors:[a.pubkey],kinds:[a.kind]},n=s({describe:"\u83B7\u53D6Event\u901A\u8FC7id"}).addFilter(t).addStaff(c()).addStaff(h()).addStaff(L(a)).addStaff(d()).addStaff(l()).addStaff(v());let f=!1;const i=async()=>{f||(f=!0,n.addStaff(y(a.pubkey)),!await n.feat.timeoutWithEvent()&&((e==null?void 0:e.urls)&&e.urls.size>0&&(n.addRelayUrls(e.urls),await n.feat.timeoutWithEvent())||(n.addReadUrl(),await n.feat.timeoutWithEvent())))};return S(`createGetEventLineByAddressPointer:${a.kind}:${a.pubkey}:${a.identifier}`,()=>{i()},20*1e3),n.feat.withEvent()||i(),n},{useLocalStorage:!1})}export{D as c,C as e,F as g};
