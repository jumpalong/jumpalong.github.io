import{f as Z,n as k,aq as p,y as f,z as x,A as e,H as t,C as a,ab as O,O as u,db as ie,bt as de,aQ as S,D as d,F as r,bL as J,I as D,J as Q,L as H,G as ce,Y as M,an as _e,U as pe,d6 as me,a_ as fe,_ as ve,aZ as K,fl as he}from"./index.77ea77b9.js";import{_ as W,a as ye}from"./AddButton.vue_vue_type_script_setup_true_lang.a1a0f627.js";import{_ as ge,a as be}from"./Drawer.vue_vue_type_script_setup_true_lang.3b66130a.js";import{S as j}from"./Scrollbar.70ddaf14.js";import{_ as ke}from"./Input.ce4c88ec.js";import{_ as X}from"./Thing.e7ed0288.js";import{_ as Y}from"./RelayConnectListCard.vue_vue_type_script_setup_true_lang.14264fe5.js";import{_ as we}from"./UserLink.vue_vue_type_script_setup_true_lang.fb95473e.js";import{b as Ce}from"./getCacheStaff.5c77dca0.js";import{r as xe}from"./use.86d0677f.js";import{u as Se}from"./use-theme-vars.64fe2e7b.js";import{_ as Le,a as Ue}from"./Checkbox.d9aac2a8.js";import{_ as $e}from"./Space.348ee95f.js";import{_ as Re}from"./Empty.1be5048e.js";import"./RelayInfoView.15227627.js";import"./Ellipsis.6a608e92.js";import"./Icon.5251a253.js";import"./ListItem.2e5c4d9c.js";import"./DrawerContent.7b649d5f.js";import"./ReloadCircleSharp.b3abc11d.js";import"./Scrollbar.e8fd977e.js";import"./user.402cd3d3.js";import"./nostr.21676584.js";import"./autoAddRelayurlByEventIdStaff.9992a924.js";import"./get-slot.4ceacf82.js";const Pe=Z({__name:"AddRelay",props:{show:{type:Boolean},disabledList:null},emits:["add-relay","update:show"],setup(h,{emit:v}){const w=k(()=>O.getOtherList()),m=p("");return(L,c)=>{const y=ke,U=X;return f(),x(ge,{show:h.show,"onUpdate:show":c[2]||(c[2]=_=>v("update:show",_)),closable:"",height:"100%",title:a(u)("add_relay")},{default:e(()=>[t(j,null,{default:e(()=>[t(U,{class:"my-2"},{header:e(()=>[t(y,{value:m.value,"onUpdate:value":c[0]||(c[0]=_=>m.value=_),placeholder:"eg: wss://relay.com",size:"small"},null,8,["value"])]),"header-extra":e(()=>[t(W,{onClick:c[1]||(c[1]=()=>v("add-relay",m.value)),disabled:h.disabledList&&h.disabledList.has(m.value)},null,8,["disabled"])]),_:1}),t(ye,{urls:a(w),loadable:""},{right:e(({url:_})=>[t(W,{onClick:()=>v("add-relay",_),disabled:h.disabledList&&h.disabledList.has(_)},null,8,["onClick","disabled"])]),_:1},8,["urls"])]),_:1})]),_:1},8,["show","title"])}}}),Te=["id"],Ve=S("div",{class:"grid grid-cols-2"},null,-1),st=Z({__name:"MoveHouseView",setup(h){const v=p(O.getReadList()),w=p(O.getWriteList()),m=p(!1),L=p(!1),c=[0,1,2,3,4,5,6,7,8,40,41,42,43,44,1984,9734,9735,1e4,10001,10002,3e4,30001,30008,30009,30023,30078],y=xe("checkedKinds",c),U=ie(),_=k(()=>U.value?[U.value]:[]),$=k(()=>[..._.value]),C=p(new Map),F=k(()=>[{kinds:y.value,authors:$.value}]),R=k(()=>(C.value.clear(),M.createChild().addStaff(Ce()).addFilters(F.value).addStaff({push(s){var o;const l=s.kind;C.value.set(l,((o=C.value.get(l))!=null?o:0)+1)}}).addExtends(M)));function ee(){m.value=!0,R.value.addExtends(M.createChild().addStaff(_e()).addFilters(F.value).addRelayUrls(v.value))}const q=he(10),P=k(()=>{let s=0;for(const[l,o]of C.value)s+=o;return s}),T=p(new Map);function te(){return{ok:0,error:0,ignore:0}}function G(s,l){const o=l.get(s);if(!o){const i=te();return T.value.set(s,i),i}return o}function ae(){const s=pe(new Map);T.value=s,L.value=!0,M.createChild().addFilters(F.value).addStaff({push(l){q.unShift(()=>{var o;R.value.getRelayEmiter().on("ok",l.id,({ok:i,url:B})=>{const g=G(B,s);i?g.ok++:g.error++},{overtime:6e4});for(const i of w.value){if((o=me(l.id))!=null&&o.has(i)){G(i,s).ignore++;continue}q.unShift(()=>{R.value.publish(l,new Set().add(i),{autoPublishToTagR:!1})})}})}}).addExtends(R.value)}const N=Se(),le=de(),V=p(null);function se(s){var l;(l=V.value)==null||l.add(s),le.success(u("successfully_added"))}const A=p(!1);function ne(){V.value=v.value,A.value=!0}function oe(){V.value=w.value,A.value=!0}return(s,l)=>{const o=Ue,i=X,B=Le,g=fe,E=ve,z=$e,ue=Re;return f(),x(be,null,{default:e(({id:re})=>{var I;return[t(Pe,{show:A.value,"onUpdate:show":l[0]||(l[0]=n=>A.value=n),onAddRelay:se,disabledList:(I=V.value)!=null?I:void 0},null,8,["show","disabledList"]),S("div",{id:re},[t(j,null,{default:e(()=>[t(z,{vertical:""},{default:e(()=>[t(g,{title:a(u)("kind")},{"header-extra":e(()=>[d(r(a(P)),1)]),default:e(()=>[t(B,{value:a(y),"onUpdate:value":[l[1]||(l[1]=n=>J(y)?y.value=n:null),l[2]||(l[2]=()=>{m.value=!1,L.value=!1})]},{default:e(()=>[(f(),D(H,null,Q(c,n=>t(i,null,{header:e(()=>[t(o,{value:n,label:a(u)(`kind${n}`)},null,8,["value","label"])]),"header-extra":e(()=>{var b;return[d(r((b=C.value.get(n))!=null?b:0),1)]}),_:2},1024)),64))]),_:1},8,["value"])]),_:1},8,["title"]),t(g,{title:a(u)("include_user")},{default:e(()=>[t(B,{value:a($),"onUpdate:value":l[3]||(l[3]=n=>J($)?$.value=n:null)},{default:e(()=>[Ve,(f(!0),D(H,null,Q(a(_),n=>(f(),x(o,{value:n},{default:e(()=>[t(we,{withPrefix:!1,value:n},null,8,["value"])]),_:2},1032,["value"]))),256))]),_:1},8,["value"])]),_:1},8,["title"]),t(Y,{urls:v.value,title:a(u)("pull")},{action:e(()=>[t(z,null,{default:e(()=>[t(E,{disabled:m.value,type:"primary",onClick:ee},{default:e(()=>[d(r(a(u)("pull")),1)]),_:1},8,["disabled"]),t(E,{type:"primary",onClick:ne},{default:e(()=>[d(r(a(u)("add_relay")),1)]),_:1})]),_:1})]),_:1},8,["urls","title"]),t(Y,{urls:w.value,title:a(u)("push")},{action:e(()=>[t(z,null,{default:e(()=>[t(E,{disabled:L.value||a(P)===0,type:"primary",onClick:ae},{default:e(()=>[d(r(a(u)("push"))+"("+r(a(P))+") ",1)]),_:1},8,["disabled"]),t(E,{type:"primary",onClick:oe},{default:e(()=>[d(r(a(u)("add_relay")),1)]),_:1})]),_:1})]),_:1},8,["urls","title"]),t(g,{title:a(u)("result")},{"header-extra":e(()=>[d(r(a(P)),1)]),default:e(()=>[T.value.size===0?(f(),x(ue,{key:0,description:a(u)("empty_text")},null,8,["description"])):ce("",!0),(f(!0),D(H,null,Q(T.value,([n,b])=>(f(),x(i,null,{header:e(()=>[d(r(n),1)]),"header-extra":e(()=>[S("span",{style:K({color:a(N).successColor})},r(b.ok),5),d(" / "),S("span",{style:K({color:a(N).primaryColor})},r(b.ignore),5),d(" / "),S("span",{style:K({color:a(N).errorColor})},r(b.error),5)]),_:2},1024))),256))]),_:1},8,["title"])]),_:1})]),_:1})],8,Te)]}),_:1})}}});export{st as default};
